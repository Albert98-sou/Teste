name: Deploy-Vast-GPU-Windows

on:
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:

      - name: Install Vast CLI
        run: |
          pip install vastai

      - name: Set API Key
        run: |
          vastai set api-key ${{ secrets.VAST_API_KEY }}

      - name: Get Cheapest RTX 4090 Offer
        id: get_offer
        run: |
          OFFER=$(vastai search offers "gpu_name=RTX_4090 rentable=True" --raw | jq -r '.[0].id')
          echo "OFFER_ID=$OFFER" >> $GITHUB_ENV

      - name: Create Windows Instance
        run: |
          vastai create instance $OFFER_ID \
            --image vastai/windows11 \
            --disk 100

      - name: Show Instances
        run: |
          vastai show instances
