name: Deploy-Vast-GPU-Windows

on:
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:

      # =============================
      # INSTALL VAST CLI
      # =============================
      - name: Install Vast CLI
        run: |
          pip install vastai

      # =============================
      # LOGIN VAST
      # =============================
      - name: Set API Key
        run: |
          vastai set api-key ${{ secrets.VAST_API_KEY }}

      # =============================
      # SEARCH RTX 4090
      # =============================
      - name: Search RTX 4090
        run: |
          vastai search offers 'gpu_name=RTX_4090'

      # =============================
      # CREATE WINDOWS INSTANCE
      # =============================
      - name: Create Windows VM
        run: |
          vastai create instance <OFFER_ID> \
            --image vastai/windows11 \
            --disk 100 \
            --onstart-cmd "powershell -Command \"Enable-NetFirewallRule -DisplayGroup 'Remote Desktop'\""

      # =============================
      # SHOW INSTANCES
      # =============================
      - name: Show Instance Info
        run: |
          vastai show instances
