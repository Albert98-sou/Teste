name: RDP-FC26-WIN10

on:
  workflow_dispatch:

jobs:
  gaming-setup:
    # windows-2019 é o equivalente ao Windows 10 no GitHub Actions
    runs-on: windows-2019
    timeout-minutes: 360 # Aumentado para 6 horas (limite do GitHub)

    steps:
      - name: Otimizar Windows para Performance
        shell: powershell
        run: |
          # Habilita RDP e desativa restrições de autenticação
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -Name "fDenyTSConnections" -Value 0 -Force
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -Name "UserAuthentication" -Value 0 -Force
          New-NetFirewallRule -DisplayName "RDP-Fast" -Direction Inbound -LocalPort 3389 -Protocol TCP -Action Allow
          
          # Cria usuário Gamer_Admin
          $password = "NvidiaRTX2026!"
          $securePass = ConvertTo-SecureString $password -AsPlainText -Force
          New-LocalUser -Name "Gamer_Admin" -Password $securePass -AccountNeverExpires
          Add-LocalGroupMember -Group "Administrators" -Member "Gamer_Admin"

      - name: Instalar Dependências (NVIDIA, DirectX, EA App)
        shell: powershell
        run: |
          # Instala o WinGet (caso não esteja atualizado)
          $ProgressPreference = 'SilentlyContinue'
          
          # Instala o EA App para rodar o FC 26
          winget install --id ElectronicArts.EADesktop --silent --accept-package-agreements --accept-source-agreements
          
          # Instala DirectX e Visual C++ (Essencial para o motor Frostbite)
          winget install --id Microsoft.DirectX --silent --accept-package-agreements
          winget install --id Microsoft.VCRedist.2015+.x64 --silent --accept-package-agreements
          
          # Tenta instalar o Driver NVIDIA (Nota: Pode falhar se o Runner não detectar hardware NVIDIA)
          winget install --id Nvidia.GeForceExperience --silent --accept-package-agreements

      - name: Configurar Tailscale (VPN)
        shell: powershell
        run: |
          Invoke-WebRequest -Uri "https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi" -OutFile "ts.msi"
          Start-Process msiexec.exe -ArgumentList "/i", "ts.msi", "/quiet", "/norestart" -Wait
          & "$env:ProgramFiles\Tailscale\tailscale.exe" up --authkey=${{ secrets.TAILSCALE_AUTH_KEY }} --hostname=win10-fc26-runner

      - name: Informações de Acesso
        shell: powershell
        run: |
          $tsIP = & "$env:ProgramFiles\Tailscale\tailscale.exe" ip -4
          Write-Host "=========================================="
          Write-Host "MÁQUINA PRONTA PARA FC 26"
          Write-Host "IP PARA RDP: $tsIP"
          Write-Host "Usuário: Gamer_Admin"
          Write-Host "Senha: NvidiaRTX2026!"
          Write-Host "=========================================="
          # Mantém o workflow vivo
          while ($true) { Start-Sleep -Seconds 300 }
