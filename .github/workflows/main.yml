name: Unreal Engine 5 Build

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: self-hosted

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Set Unreal Engine Path
        run: |
          echo "UE_PATH=C:\Program Files\Epic Games\UE_5.3" >> $env:GITHUB_ENV
        shell: powershell

      - name: Generate Project Files
        run: |
          & "$env:UE_PATH\Engine\Build\BatchFiles\GenerateProjectFiles.bat" `
          -project="$env:GITHUB_WORKSPACE\MyGame.uproject" `
          -game -engine
        shell: powershell

      - name: Build Project
        run: |
          & "$env:UE_PATH\Engine\Build\BatchFiles\Build.bat" `
          MyGameEditor Win64 Development `
          -project="$env:GITHUB_WORKSPACE\MyGame.uproject"
        shell: powershell

      - name: Package Game
        run: |
          & "$env:UE_PATH\Engine\Build\BatchFiles\RunUAT.bat" BuildCookRun `
          -project="$env:GITHUB_WORKSPACE\MyGame.uproject" `
          -noP4 -platform=Win64 -clientconfig=Shipping `
          -cook -allmaps -build -stage -pak -archive `
          -archivedirectory="$env:GITHUB_WORKSPACE\Build"
        shell: powershell

      - name: Upload Build Artifact
        uses: actions/upload-artifact@v4
        with:
          name: UnrealBuild
          path: Build
